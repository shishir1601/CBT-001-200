PROC 0 DEBUG
/*                                                               */
/*  PHONOPER - PRINT OPERATORS PHONE LIST                        */
/*                                                               */
/*  FIND ?? FOR TESTING NOTES                                    */
/*                                                               */
CONTROL NOLIST NOMSG NOFLUSH PROMPT
IF &DEBUG NE &STR() THEN +
  CONTROL LIST MSG NOFLUSH PROMPT CONLIST SYMLIST
ISPEXEC CONTROL ERRORS RETURN
ISPEXEC DISPLAY PANEL(PHONOPER)
IF &LASTCC = 8 THEN +
  DO
    ISPEXEC  SETMSG MSG(PHN009T)
    GOTO DONE
  END
CKCOPIES: +
  ISPEXEC  VGET (PHONADM PHONAEB PHONDMT PHONFMS PHONPAS PHONPSB PHONREG8 PHONSHV PHONSTP) ASIS
  IF (&PHONADM = ' ') OR (&PHONADM = &STR()) OR (&PHNADM = 0) THEN +
    IF (&PHONAEB = ' ') OR (&PHONAEB = &STR()) OR (&PHNAEB = 0) THEN +
      IF (&PHONDMT = ' ') OR (&PHONDMT = &STR()) OR (&PHNDMT = 0) THEN +
        IF (&PHONFMS = ' ') OR (&PHONFMS = &STR()) OR (&PHNFMS = 0) THEN +
          IF (&PHONPAS = ' ') OR (&PHONPAS = &STR()) OR (&PHNPAS = 0) THEN +
            IF (&PHONPSB = ' ') OR (&PHONPSB = &STR()) OR (&PHNPSB = 0) THEN +
              IF (&PHONFOX = ' ') OR (&PHONFOX = &STR()) OR (&PHNFOX = 0) THEN +
                IF (&PHONSHV = ' ') OR (&PHONSHV = &STR()) OR (&PHNSHV = 0) THEN +
                  IF (&PHONREG8 = ' ') OR (&PHONREG8 = &STR()) OR (&PHNREG8 = 0) THEN +
                    IF (&PHONSTP = ' ') OR (&PHONSTP = &STR()) OR (&PHNSTP = 0) THEN +
                      DO
                        SET &PHNMSG = PHN009O
                        GOTO DSPLERR
                      END
  IF (&PHONADM = ' ') OR (&PHONADM = &STR()) THEN +
    SET &PHONADM = 0
  IF (&PHONAEB = ' ') OR (&PHONAEB = &STR()) THEN +
    SET &PHONAEB = 0
  IF (&PHONDMT = ' ') OR (&PHONDMT = &STR()) THEN +
    SET &PHONDMT = 0
  IF (&PHONFMS = ' ') OR (&PHONFMS = &STR()) THEN +
    SET &PHONFMS = 0
  IF (&PHONPAS = ' ') OR (&PHONPAS = &STR()) THEN +
    SET &PHONPAS = 0
  IF (&PHONPSB = ' ') OR (&PHONPSB = &STR()) THEN +
    SET &PHONPSB = 0
  IF (&PHONFOX = ' ') OR (&PHONFOX = &STR()) THEN +
    SET &PHONFOX = 0
  IF (&PHONSHV = ' ') OR (&PHONSHV = &STR()) THEN +
    SET &PHONSHV = 0
  IF (&PHONREG8 = ' ') OR (&PHONREG8 = &STR()) THEN +
    SET &PHONREG8 = 0
  IF (&PHONSTP = ' ') OR (&PHONSTP = &STR()) THEN +
    SET &PHONSTP = 0
  SET &PHONETOT = &PHONADM + &PHONAEB + &PHONDMT + &PHONFMS + &PHONPAS + &PHONPSB +&PHONFOX + &PHONREG8 + &PHONSHV + &PHONSTP
  IF &PHONETOT ^> 20 THEN +
    GOTO CONT
  SET &PHNMSG = PHN009M
DSPLERR: +
ISPEXEC  DISPLAY  PANEL(PHONOPER) MSG(&PHNMSG)
  IF &LASTCC = 8 THEN +
    DO
      ISPEXEC  SETMSG MSG(PHN009T)
      GOTO DONE
    END
GOTO CKCOPIES
CONT: +
  DO WHILE &PHONADM > 0
    SET &PHONPARM = &STR(&PHONPARM.ADM )
    SET &PHONADM = &PHONADM - 1
  END
  DO WHILE &PHONAEB > 0
    SET &PHONPARM = &STR(&PHONPARM.AEB )
    SET &PHONAEB = &PHONAEB - 1
  END
  DO WHILE &PHONDMT > 0
    SET &PHONPARM = &STR(&PHONPARM.DMT )
    SET &PHONDMT = &PHONDMT - 1
  END
  DO WHILE &PHONFMS > 0
    SET &PHONPARM = &STR(&PHONPARM.FMS )
    SET &PHONFMS = &PHONFMS - 1
  END
  DO WHILE &PHONPAS > 0
    SET &PHONPARM = &STR(&PHONPARM.PAS )
    SET &PHONPAS = &PHONPAS - 1
  END
  DO WHILE &PHONPSB > 0
    SET &PHONPARM = &STR(&PHONPARM.PSB )
    SET &PHONPSB = &PHONPSB - 1
  END
  DO WHILE &PHONFOX > 0
    SET &PHONPARM = &STR(&PHONPARM.FOX )
    SET &PHONFOX = &PHONFOX - 1
  END
  DO WHILE &PHONSHV > 0
    SET &PHONPARM = &STR(&PHONPARM.SHV )
    SET &PHONSHV = &PHONSHV - 1
  END
  DO WHILE &PHONREG8 > 0
    SET &PHONPARM = &STR(&PHONPARM.REG8)
    SET &PHONREG8 = &PHONREG8 - 1
  END
  DO WHILE &PHONSTP > 0
    SET &PHONPARM = &STR(&PHONPARM.STP )
    SET &PHONSTP = &PHONSTP - 1
  END
/*                                                               */
/*  CREATE SEQUENTIAL C271 FILE FROM PHONE TABLE                 */
/*                                                               */
ERROR +
  DO
    ISPEXEC  SETMSG MSG(PHN009Y)
    EXIT
  END
ISPEXEC  CONTROL DISPLAY REFRESH
ALLOC F(SYSUDUMP) SYSOUT(X)
ALLOC F(SYSOUT) SYSOUT(X)
ALLOC F(O271C) DA(&SYSUID..T271C) NEW SPACE(65 10) BLKSIZE(6160) REUSE UNIT(SYSDA) RELEASE CATALOG LRECL(80) RECFM(F B)
ERROR OFF
ISPEXEC SELECT PGM(PHONDUMP) NEWAPPL(PHN)
SET &RC = &LASTCC
FREE F(SYSUDUMP SYSOUT O271C)
/*                                                               */
/*  SORT C271                                                    */
/*                                                               */
ERROR +
  DO
    ISPEXEC  SETMSG MSG(PHN009Y)
    FREE F(&FREE)
    EXIT
  END
ALLOC F(SYSUDUMP) DUMMY
SET &FREE EQ &STR(SYSUDUMP)
ALLOC F(SYSOUT) DUMMY
SET &FREE EQ &STR(&FREE SYSOUT)
ALLOC F(SYSIN) NEW SPACE(1 1) BLOCK(80) BLKSIZE(80) REUSE UNIT(SYSDA) RELEASE DELETE LRECL(80) RECFM(F)
SET &FREE EQ &STR(&FREE SYSIN)
OPENFILE SYSIN OUTPUT
SET &SYSIN EQ &STR( SORT FIELDS=(20,25,A),FORMAT=CH)
PUTFILE SYSIN
CLOSFILE SYSIN
ALLOC F(SORTIN) DA(&SYSUID..T271C) SHR REUSE DELETE
SET &FREE EQ &STR(&FREE SORTIN)
ALLOC F(SORTOUT) DA(&SYSUID..T271CS) NEW SPACE(65 10) BLOCK(80) BLKSIZE(6160) REUSE UNIT(SYSDA) RELEASE CATALOG LRECL(80) RECFM(F B)
SET &FREE EQ &STR(&FREE SORTOUT)
$ SORT
FREE F(&FREE)
/*                                                               */
/*  CREATE PHONE DIRECTORY                                       */
/*                                                               */
ALLOC F(SYSUDUMP) DUMMY
SET &FREE EQ &STR(SYSUDUMP)
ALLOC F(SYSOUT) SYSOUT(X)
SET &FREE EQ &STR(&FREE SYSOUT)
ALLOC F(SYSIN) NEW SPACE(1 1) BLOCK(80) BLKSIZE(80) REUSE UNIT(SYSDA) RELEASE DELETE LRECL(80) RECFM(F)
SET &FREE EQ &STR(&FREE SYSIN)
OPENFILE SYSIN OUTPUT
SET &SYSIN EQ &STR(&PHONPARM)
PUTFILE SYSIN
CLOSFILE SYSIN
ALLOC F(I271C) DA(&SYSUID..T271CS) SHR REUSE DELETE
SET &FREE EQ &STR(&FREE I271C)
XRXALLOC DDNAME(PRINTER1) FORM(P001) REUSE
SET &FREE EQ &STR(&FREE PRINTER1)
/*?? UNCOMMENT WHEN TESTING SO LIST WILL NOT GET PRINTED:        */
/*     FREE F(PRINTER1)                                          */
/*     ALLOC F(PRINTER1) SYSOUT(X)                               */
STEPLIB DATASET('MIS.LINKLIB') SHR
$ MIS03500
STEPLIB
FREE F(&FREE)
SET &FREE EQ &STR()
ISPEXEC  SETMSG MSG(PHN009W)
DONE: +
  SET &PHONADM = &STR( )
  SET &PHONAEB = &STR( )
  SET &PHONDMT = &STR( )
  SET &PHONFMS = &STR( )
  SET &PHONPAS = &STR( )
  SET &PHONPSB = &STR( )
  SET &PHONFOX = &STR( )
  SET &PHONSHV = &STR( )
  SET &PHONREG8 = &STR( )
  SET &PHONSTP = &STR( )
  ISPEXEC  VPUT (PHONADM PHONAEB PHONDMT PHONFMS PHONPAS PHONPSB PHONFOX PHONREG8 PHONSHV PHONSTP) ASIS
  EXIT
END
